--- 
build: 
  box: "python:2.7"
deploy-to-kubernetes: 
  box: "python:2.7"
  steps: 
    - bash-template
    - 
      script: 
        code: |
            mkdir $WERCKER_OUTPUT_DIR/kubernetes
            mv kubernetes_*.yml $WERCKER_OUTPUT_DIR/kubernetes
        name: "Prepare Kubernetes files"
    - 
      kubectl: 
        command: "apply -f $WERCKER_OUTPUT_DIR/kubernetes/"
        insecure-skip-tls-verify: true
        name: "deploy to kubernetes"
        server: $OKE_MASTER
        token: $OKE_TOKEN
    - 
      kubectl: 
        command: "patch deployment/mysql-8.0-serv -p '{\"spec\":{\"progressDeadlineSeconds\":300}}'"
        insecure-skip-tls-verify: true
        name: "set deployment timeout"
        server: $OKE_MASTER
        token: $OKE_TOKEN
    - 
      kubectl: 
        command: "rollout status deployment/mysql-8.0-serv"
        insecure-skip-tls-verify: true
        name: "check deployment status"
        server: $OKE_MASTER
        token: $OKE_TOKEN
